<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>CNYES æ¼²å¹…æ’è¡Œ</title>

  <style>
    body { font-family: system-ui; padding:20px; background:#f5f7fa; }
    table { width:100%; border-collapse:collapse; background:white; }
    th,td { padding:10px; border-bottom:1px solid #eee; }
    th { background:#f0f2f5; text-align:left; }
    .up { color:#c0392b; font-weight:600; }
    .down { color:#27ae60; font-weight:600; }
    .delta-new { color:#8e44ad; }
    .delta-up { color:#c0392b; }
    .delta-down { color:#27ae60; }
    .delta-same { color:#7f8c8d; }
  </style>
</head>

<body>

<h1>ğŸ“ˆ CNYES å°è‚¡æ¼²å¹…æ’è¡Œ</h1>
<div id="meta"></div>
<div id="content">è¼‰å…¥ä¸­...</div>

<div style="margin:12px 0;">
  <button class="range-btn" data-r="50">Top 50</button>
  <button class="range-btn" data-r="100">Top 100</button>
  <button class="range-btn" data-r="200">Top 200</button>
</div>

<script src="../core/core.js"></script>
<script src="./config.js"></script>

<script>
(async function(){
  const core = window.KCAiOS;
  const cfg  = window.KCDashConfig;

  const metaDOM = document.getElementById("meta");
  const content = document.getElementById("content");

  const today = await core.loadToday(cfg.DATA_PATH);
  const yData = await core.loadYesterday(cfg.DATA_PATH);

  // å»ºç«‹ yesterday map
  const yMap = {};
  if (yData?.items) {
    yData.items.forEach(x => { yMap[x.code] = x.rank; });
  }

  // æ¸²æŸ“ meta
  core.renderMeta(metaDOM, today, yData);

  // é è¨­é¡¯ç¤ºç¯„åœ
  core.renderTable(content, today, yMap, cfg.DEFAULT_RANGE);

  // è¨­å®šæŒ‰éˆ•åˆ‡æ›
  document.querySelectorAll(".range-btn").forEach(btn => {
    btn.onclick = () => {
      const r = Number(btn.dataset.r);
      core.renderTable(content, today, yMap, r);
    };
  });

})();
</script>

</body>
</html>
